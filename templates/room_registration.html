{% extends 'base.html' %}
{% block content %}
<h2>Available Rooms</h2>

<div style="display:flex; gap:20px;">
  <!-- Filter Sidebar -->
  <div style="border:1px solid #ccc; padding:10px; width:200px;">
    <h4>Filters</h4>

    <!-- AC Filter -->
    <p><strong>AC Type</strong></p>
    <label><input type="radio" name="ac_filter" value="any" checked> Any</label><br>
    <label><input type="radio" name="ac_filter" value="ac"> AC</label><br>
    <label><input type="radio" name="ac_filter" value="non-ac"> Non-AC</label><br>

    <!-- Room Type Filter -->
    <p><strong>Room Type</strong></p>
    <label><input type="radio" name="room_type" value="any" checked> Any</label><br>
    <label><input type="radio" name="room_type" value="double"> Double</label><br>
    <label><input type="radio" name="room_type" value="triple"> Triple</label>
  </div>

  <!-- Room List + Request Form -->
  <div style="flex:1;">
    <!-- Room request form -->
    <form method="post">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <label>Select room:
        <select name="room_id" id="roomSelect" style="width:100%; padding:6px;">
          {% for r in rooms %}
            <option value="{{ r._id }}">
              {{ r.room_no }} - Capacity: {{ r.vacancies }} - AC: {{ r.ac_type }} - Room Type: {{ r.room_type }} - Occupied: {{ r.current_students }} - Available: {{ r.available }}
            </option>
          {% endfor %}
        </select>
      </label>
      <button type="submit" style="margin-top:10px;">Request Room</button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const acRadios = document.querySelectorAll('input[name="ac_filter"]');
  const typeRadios = document.querySelectorAll('input[name="room_type"]');
  const roomSelect = document.getElementById('roomSelect');

  async function fetchRooms() {
    const ac = document.querySelector('input[name="ac_filter"]:checked').value;
    const type = document.querySelector('input[name="room_type"]:checked').value;

    const response = await fetch(`/student/rooms/filter?ac=${ac}&room_type=${type}`);
    const rooms = await response.json();

    roomSelect.innerHTML = ''; // Clear old options
    if (rooms.length === 0) {
      const option = document.createElement('option');
      option.textContent = 'No rooms available';
      option.disabled = true;
      roomSelect.appendChild(option);
    } else {
      rooms.forEach(r => {
        const option = document.createElement('option');
        option.value = r._id;
        option.textContent = `${r.room_no} - Capacity: ${r.vacancies} - AC: ${r.ac_type} - Room Type: ${r.room_type} - Occupied: ${r.current_students} - Available: ${r.available}`;
        roomSelect.appendChild(option);
      });
    }
  }

  acRadios.forEach(radio => radio.addEventListener('change', fetchRooms));
  typeRadios.forEach(radio => radio.addEventListener('change', fetchRooms));
});
</script>
{% endblock %}
